{% extends "base.html" %}
{% block body %}
  <h2>Register</h2>
  <form id="register-form">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Register</button>
  </form>
<p><a href="{% url 'login_view' %}">Login</a> if you already have an account.</p>

  <script >
    // handle form submission via AJAX
    document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('register-form');
    form.addEventListener('submit', function(event) {
        event.preventDefault();
        const username = form.querySelector('input[name="username"]').value;
        const password = form.querySelector('input[name="password"]').value;
        const email = form.querySelector('input[name="email"]').value;
        fetch("{% url 'register_api' %}", {
            method: 'POST',
            body: JSON.stringify({ username, password, email }),
            headers: {
                "Content-Type": "application/json"
            }
        })
        .then(response => response.json() )
        .then(data => {
            if (data.success) {
                alert ("Registration successful! You can now log in.");
                window.location.href = "{% url 'login_view' %}";
            } else {
                // Handle errors
                alert('Error during registration: ' + data.errors.join(', '));
            }
        });
    });
});
  </script>
{% endblock %}